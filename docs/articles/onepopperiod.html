<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with a single population and transition • raretrans</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with a single population and transition">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raretrans</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/onepopperiod.html">Working with a single population and transition</a>
    </li>
    <li>
      <a href="../articles/transition_priors.html">Effect of prior information on transition probabilities and fertilities</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atyre2/raretrans">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with a single population and transition</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atyre2/raretrans/blob/master/vignettes/onepopperiod.Rmd"><code>vignettes/onepopperiod.Rmd</code></a></small>
      <div class="hidden name"><code>onepopperiod.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">echo =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## Warning: package 'tibble' was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package 'dplyr' was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package 'stringr' was built under R version 3.5.2</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(popbio)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">library</span>(popdemo)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">library</span>(raretrans)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># Raymond's theme modifications</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">rlt_theme &lt;-<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>,<span class="dt">face=</span><span class="st">"bold"</span>),</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>, <span class="dt">face=</span><span class="st">"bold"</span>),</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>,<span class="dt">face=</span><span class="st">"bold"</span>),  </a>
<a class="sourceLine" id="cb5-8" data-line-number="8">        <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>,<span class="dt">face=</span><span class="st">"bold"</span>))</a></code></pre></div>
<p>We want to be able to use this package with single populations and transitions. Regardless of how many populations there are, we need the data in the form expected by <code>popbio::projection_matrix</code> to get the matrices we want. Here we demonstrate how the package works with a single population in the desired format, by extracting the transition and fertility data for <em>L. elto</em> POPNUM 250 in period 5.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">data</span>(<span class="st">"L_elto"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">onepop &lt;-<span class="st"> </span><span class="kw">filter</span>(L_elto, POPNUM <span class="op">==</span><span class="st"> </span><span class="dv">250</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stage =</span> <span class="kw">case_when</span>(stage <span class="op">==</span><span class="st"> "p"</span> <span class="op">~</span><span class="st"> "s"</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>stage),</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">         <span class="dt">next_stage =</span> <span class="kw">case_when</span>(next_stage <span class="op">==</span><span class="st"> "p"</span><span class="op">~</span><span class="st"> "s"</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                                <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>next_stage))</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#popbio::projection.matrix doesn't like tibbles</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">TF &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/popbio/topics/projection.matrix">projection.matrix</a></span>(<span class="kw">as.data.frame</span>(onepop), </a>
<a class="sourceLine" id="cb6-9" data-line-number="9">                        <span class="dt">stage =</span> stage, <span class="dt">fate =</span> next_stage, </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">                        <span class="dt">fertility=</span><span class="st">"fertility"</span>, <span class="dt">sort=</span><span class="kw">c</span>(<span class="st">"s"</span>,<span class="st">"j"</span>,<span class="st">"a"</span>), <span class="dt">TF =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">TF</a></code></pre></div>
<pre><code>## $T
##    
##              s          j          a
##   s 0.09090909 0.00000000 0.00000000
##   j 0.63636364 0.57446809 0.00000000
##   a 0.00000000 0.29787234 0.85294118
## 
## $F
##    
##             s         j         a
##   s 0.0000000 0.0000000 0.1176471
##   j 0.0000000 0.0000000 0.0000000
##   a 0.0000000 0.0000000 0.0000000</code></pre>
<p>Now we also need the number of individuals in each stage at the start. This is because our priors are based on counts, and the prior equivalent sample size is expressed as a multiple of the number of individuals observed. We have a function <code><a href="../reference/get_state_vector.html">raretrans::get_state_vector()</a></code> to do this.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">N &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_state_vector.html">get_state_vector</a></span>(onepop, <span class="dt">stage =</span> stage, <span class="dt">sort=</span><span class="kw">c</span>(<span class="st">"s"</span>,<span class="st">"j"</span>,<span class="st">"a"</span>))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">N</a></code></pre></div>
<pre><code>## [1] 11 47 34</code></pre>
<p>The rare transition that is missing from this matrix is the seedling to adult, which in the RLT prior happens ~ 1% of the time. The observed asymptotic population growth rate is <span class="math inline">\(\lambda =\)</span> 0.93.</p>
<p>First, use the default uniform prior on transitions and uninformative gamma on fecundity. We have to specify the parameters for the fecundity prior on non-reproducing stages as missing, or the result will fill in the entire matrix. The default for both functions returns the full matrix <strong>A</strong>, so we have to tell the function to only return the transition and fecundity matrices.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">unif &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">T =</span> <span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">returnType =</span> <span class="st">"T"</span>), </a>
<a class="sourceLine" id="cb10-2" data-line-number="2">             <span class="dt">F =</span> <span class="kw"><a href="../reference/fill_fecundity.html">fill_fecundity</a></span>(TF, N, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                                <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                                <span class="dt">beta =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                                <span class="dt">returnType =</span> <span class="st">"F"</span>))</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">unif</a></code></pre></div>
<pre><code>## $T
##            [,1]        [,2]        [,3]
## [1,] 0.10416667 0.005208333 0.007142857
## [2,] 0.60416667 0.567708333 0.007142857
## [3,] 0.02083333 0.296875000 0.835714286
## 
## $F
##      [,1] [,2]      [,3]
## [1,]    0    0 0.1176473
## [2,]    0    0 0.0000000
## [3,]    0    0 0.0000000</code></pre>
<p>And the asymptotic population growth rate is <span class="math inline">\(\lambda =\)</span> 0.92. The growth rate shrinks slightly because applying the uniform prior on transition probabilities causes observed growth and survival transitions to shrink slightly relative to those that are unobserved.</p>
<p>There are two other returnTypes. <code><a href="../reference/fill_transitions.html">fill_transitions()</a></code> can return an augmented matrix of fates which is useful for simulation.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">returnType =</span> <span class="st">"TN"</span>)</a></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]
## [1,] 1.25  0.25  0.25
## [2,] 7.25 27.25  0.25
## [3,] 0.25 14.25 29.25
## [4,] 3.25  6.25  5.25</code></pre>
<p>The fourth row of this result is the mortality state. <code><a href="../reference/fill_fecundity.html">fill_fecundity()</a></code> can return the alpha and beta vectors of the posterior.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="../reference/fill_fecundity.html">fill_fecundity</a></span>(TF, N, </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">               <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">               <span class="dt">beta =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">               <span class="dt">returnType =</span> <span class="st">"ab"</span>)</a></code></pre></div>
<pre><code>## $alpha
##       s       j       a 
##      NA      NA 4.00001 
## 
## $beta
## [1]       NA       NA 34.00001</code></pre>
<p>This demonstrates why the posterior point estimate of fecundity does not change much; the non-informative values for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> barely change the observed values.</p>
<div id="informative-priors" class="section level1">
<h1 class="hasAnchor">
<a href="#informative-priors" class="anchor"></a>Informative Priors</h1>
<p>We can skip using <code><a href="http://www.rdocumentation.org/packages/popbio/topics/projection.matrix">popbio::projection.matrix()</a></code> if the matrix is already calculated, as long as we also have the stage vector. We use population 231 in period 2 as an example, splitting the matrix into transition T and fecundity F matrices.</p>
<pre><code>## $Tmat
##     stage
## fate         p         j         a
##    p 0.5000000 0.0000000 0.0000000
##    j 0.0000000 0.8333333 0.0000000
##    a 0.0000000 0.1666667 0.8750000
## 
## $Fmat
##      [,1] [,2]  [,3]
## [1,]    0    0 0.125
## [2,]    0    0 0.000
## [3,]    0    0 0.000</code></pre>
<p>There were 2, 6, 16 seedlings, juveniles, and adults, respectively, at the start of period 2. This matrix is missing the rare transition from seedling to juvenile, and no juveniles died leading to an overestimate of survival. So, to add a uniform dirichlet prior with a weight of 1 to <span class="math inline">\(T\)</span>, we have 4 fates (3 + death), so each fate adds 0.25 to the matrix of <em>observed</em> fates (not the transition matrix!). When we specify a prior matrix for the transitions, there is one more row than columns. This extra row represents death.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">Tprior &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="fl">0.25</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">nrow=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> Tprior) <span class="co"># returns transition matrix by default</span></a></code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,] 0.41666667 0.03571429 0.01470588
## [2,] 0.08333333 0.75000000 0.01470588
## [3,] 0.08333333 0.17857143 0.83823529</code></pre>
<p>You can get the same result ‘by hand’</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">Tobs &lt;-<span class="st"> </span><span class="kw">sweep</span>(TF<span class="op">$</span>Tmat,<span class="dv">2</span>,N,<span class="st">"*"</span>) <span class="co"># get the observed transitions</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">Tobs &lt;-<span class="st"> </span><span class="kw">rbind</span>(Tobs, N <span class="op">-</span><span class="st"> </span><span class="kw">colSums</span>(Tobs)) <span class="co"># add the mortality row</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">Tobs &lt;-<span class="st"> </span>Tobs <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span> <span class="co"># add the prior</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="kw">sweep</span>(Tobs, <span class="dv">2</span>, <span class="kw">colSums</span>(Tobs), <span class="st">"/"</span>)[<span class="op">-</span><span class="dv">4</span>,] <span class="co"># divide by the column sum, and discard mortality</span></a></code></pre></div>
<pre><code>##            p          j          a
## p 0.41666667 0.03571429 0.01470588
## j 0.08333333 0.75000000 0.01470588
## a 0.08333333 0.17857143 0.83823529</code></pre>
<p>The uniform prior creates problems by filling in finite values for transitions that are impossible, such as adult-&gt;seedling (should only be in fecundity matrix). To fix this problem we specify a more informative prior. It still has to have the same shape, one more row than columns.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">RLT_Tprior &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.025</span>, <span class="fl">0.0</span>,</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">                       <span class="fl">0.05</span>, <span class="fl">0.9</span>,   <span class="fl">0.025</span>,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">                       <span class="fl">0.01</span>, <span class="fl">0.025</span>, <span class="fl">0.95</span>,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">                       <span class="fl">0.69</span>, <span class="fl">0.05</span>,  <span class="fl">0.025</span>), </a>
<a class="sourceLine" id="cb21-5" data-line-number="5">                     <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>This prior is constructed so the columns sum to 1, which creates the greatest flexibility for weighting the prior.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior)</a></code></pre></div>
<pre><code>##             [,1]        [,2]        [,3]
## [1,] 0.416666667 0.003571429 0.000000000
## [2,] 0.016666667 0.842857143 0.001470588
## [3,] 0.003333333 0.146428571 0.879411765</code></pre>
<p>We can specify the weight as a multiple of the sample size for each stage.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">priorweight =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>##             [,1]        [,2]        [,3]
## [1,] 0.416666667 0.008333333 0.000000000
## [2,] 0.016666667 0.855555556 0.008333333
## [3,] 0.003333333 0.119444444 0.900000000</code></pre>
<p>Here the prior is weighted half as much as the observed number of transitions, which is larger than 1 but still allows the data to dominate.</p>
</div>
<div id="getting-credible-intervals-on-individual-matrix-entries" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-credible-intervals-on-individual-matrix-entries" class="anchor"></a>Getting Credible Intervals on individual matrix entries</h1>
<p>The marginal posterior distribution of one element in a multinomial is a beta distribution, and we use this to get credible intervals on our transition rates. We can use the TN return type to get the parameters of the desired multinomial.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">TN &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">priorweight =</span> <span class="fl">0.5</span>, <span class="dt">returnType =</span> <span class="st">"TN"</span>)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">alpha &lt;-<span class="st"> </span>TN[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">beta &lt;-<span class="st"> </span><span class="kw">sum</span>(TN[,<span class="dv">1</span>]) <span class="op">-</span><span class="st"> </span>TN[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">p &lt;-<span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span>(alpha <span class="op">+</span><span class="st"> </span>beta)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">lcl &lt;-<span class="st"> </span><span class="kw">qbeta</span>(<span class="fl">0.025</span>, alpha, beta)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">ucl &lt;-<span class="st"> </span><span class="kw">qbeta</span>(<span class="fl">0.975</span>, alpha, beta)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="kw">sprintf</span>(<span class="st">"%.2f (%.2f, %.2f)"</span>, p, lcl, ucl)</a></code></pre></div>
<pre><code>## [1] "0.42 (0.03, 0.90)" "0.02 (0.00, 0.20)" "0.00 (0.00, 0.02)"
## [4] "0.56 (0.09, 0.96)"</code></pre>
<p>Those are the point estimates (compare with first column above), lower and upper 95% credible intervals for transitions out of the seedling stage. There is a high degree of uncertainty because of the small sample size (2), and low weight on the prior (1), leading to an effective sample size of 3. If we up the effective sample size to 20 by setting priorweight = 9 (9*2 = 18 + 2 = 20)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">TN &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">priorweight =</span> <span class="dv">9</span>, <span class="dt">returnType =</span> <span class="st">"TN"</span>)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">alpha &lt;-<span class="st"> </span>TN[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">beta &lt;-<span class="st"> </span><span class="kw">sum</span>(TN[,<span class="dv">1</span>]) <span class="op">-</span><span class="st"> </span>TN[,<span class="dv">1</span>] <span class="co"># beta parameter is sum of all other dirichlet parameters.</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">p &lt;-<span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span>(alpha <span class="op">+</span><span class="st"> </span>beta)</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">lcl &lt;-<span class="st"> </span><span class="kw">qbeta</span>(<span class="fl">0.025</span>, alpha, beta)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">ucl &lt;-<span class="st"> </span><span class="kw">qbeta</span>(<span class="fl">0.975</span>, alpha, beta)</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="kw">sprintf</span>(<span class="st">"%.2f (%.2f, %.2f)"</span>, p, lcl, ucl)</a></code></pre></div>
<pre><code>## [1] "0.28 (0.11, 0.48)" "0.05 (0.00, 0.17)" "0.01 (0.00, 0.07)"
## [4] "0.67 (0.46, 0.85)"</code></pre>
<p>the credible intervals shrink quite a bit.</p>
</div>
<div id="credible-intervals-on-lambda" class="section level1">
<h1 class="hasAnchor">
<a href="#credible-intervals-on-lambda" class="anchor"></a>Credible intervals on <span class="math inline">\(\lambda\)</span>
</h1>
<p>Obtaining credible intervals on the asymptotic growth rate, <span class="math inline">\(\lambda\)</span>, requires simulating matrices from the posterior distributions. This is somewhat complicated to do correctly, and we have written a function <code><a href="../reference/sim_transitions.html">sim_transitions()</a></code> to generate a list of simulated matrices given the observed matrix and prior specifications.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="../reference/sim_transitions.html">sim_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="fl">0.025</span>), <span class="dt">beta =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">                <span class="dt">priorweight =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## [[1]]
##              [,1]       [,2]       [,3]
## [1,] 6.248136e-01 0.03034545 0.04479663
## [2,] 3.912627e-21 0.87101236 0.00688868
## [3,] 8.742142e-20 0.09607538 0.97573436</code></pre>
<p>Now we simulate 1000 times, calculate the leading eigenvalue of each matrix, and draw a histogram.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">8390278</span>) <span class="co"># make this part reproducible</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">RLT_<span class="fl">0.5</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_transitions.html">sim_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="fl">0.025</span>), <span class="dt">beta =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">                <span class="dt">priorweight =</span> <span class="fl">0.5</span>, <span class="dt">samples =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">RLT_<span class="fl">0.5</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">lposterior =</span> <span class="kw">map_dbl</span>(RLT_<span class="fl">0.5</span>, lambda))</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="kw">ggplot</span>(<span class="dt">data =</span> RLT_<span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> lposterior)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.02</span>)</a></code></pre></div>
<p><img src="onepopperiod_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>We can calculate some summary statistics too.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">RLT_<span class="fl">0.5</span>_summary &lt;-<span class="st"> </span><span class="kw">summarize</span>(RLT_<span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">                             <span class="dt">medianL =</span> <span class="kw">median</span>(lposterior),</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">                             <span class="dt">meanL =</span> <span class="kw">mean</span>(lposterior),</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">                             <span class="dt">lcl =</span> <span class="kw">quantile</span>(lposterior, <span class="dt">probs =</span> <span class="fl">0.025</span>),</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">                             <span class="dt">ucl =</span> <span class="kw">quantile</span>(lposterior, <span class="dt">probs =</span> <span class="fl">0.975</span>),</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">                             <span class="dt">pincrease =</span> <span class="kw">sum</span>(lposterior <span class="op">&gt;</span><span class="st"> </span><span class="fl">1.</span>)<span class="op">/</span><span class="kw">n</span>())</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(RLT_<span class="fl">0.5</span>_summary, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">medianL</th>
<th align="right">meanL</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
<th align="right">pincrease</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.95</td>
<td align="right">0.94</td>
<td align="right">0.83</td>
<td align="right">1</td>
<td align="right">0.01</td>
</tr></tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#informative-priors">Informative Priors</a></li>
      <li><a href="#getting-credible-intervals-on-individual-matrix-entries">Getting Credible Intervals on individual matrix entries</a></li>
      <li><a href="#credible-intervals-on-lambda">Credible intervals on <span class="math inline">\(\lambda\)</span></a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andrew Tyre, Raymond Tremblay, Maria-Eglee Perez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
